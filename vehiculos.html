<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Solicitud de Vehículos — Portal del Funcionario</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    :root { --verde:#3cb043; --azul:#004aad; --naranjo:#f57c00; }
    .bg-azul{background-color:var(--azul)} .text-azul{color:var(--azul)} .text-verde{color:var(--verde)} .text-naranjo{color:var(--naranjo)}
  </style>
  <script type="module">
    import { createClient } from 'https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2/+esm';
    const supabase = createClient('https://ocqoipzgtsanpyzjcsis.supabase.co', 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im9jcW9pcHpndHNhbnB5empjc2lzIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjExNjEwMDcsImV4cCI6MjA3NjczNzAwN30.mc3mM6ctAyQne5D_Dkw6w9BczzIE9CTe4AQFXqYsMo4');

    async function enforceAuth(){
      const { data: { session } } = await supabase.auth.getSession();
      if(!session){
        window.location.href = 'login.html';
        return;
      }
      document.getElementById('app').classList.remove('hidden');
      const emailBadge = document.getElementById('userEmail');
      if(emailBadge) emailBadge.textContent = session.user.email;
    }

    window.addEventListener('DOMContentLoaded', enforceAuth);
  </script>
</head>
<body class="bg-white text-slate-800">
  <header class="border-b">
    <div class="max-w-5xl mx-auto px-4 h-16 flex items-center justify-between">
      <a href="index.html" class="text-azul font-semibold">← Volver</a>
      <h1 class="text-xl font-bold">Solicitud de Vehículos</h1>
      <span id="userEmail" class="text-xs text-slate-500"></span>
    </div>
  </header>

  <!-- App oculta hasta comprobar sesión -->
  <main id="app" class="hidden max-w-5xl mx-auto px-4 py-8">
    <p class="text-slate-700">Completa el siguiente formulario para solicitar uso de vehículos institucionales.</p>

    <!-- Controles -->
    <div class="mt-6 flex items-center gap-2">
      <a href="https://docs.google.com/forms/d/e/1FAIpQLScz05vKOikDlfNmvacw73_zjhKntAQQEwoaJnwkT7zGX8mQ0g/viewform"
         target="_blank" rel="noopener noreferrer"
         class="px-3 py-2 rounded-xl bg-azul text-white text-sm hover:opacity-90 transition">
        Abrir en pestaña nueva
      </a>
      <button id="fitBtn" class="px-3 py-2 rounded-xl border text-sm">Ajustar a ventana</button>
      <button id="tallBtn" class="px-3 py-2 rounded-xl border text-sm">Altura grande</button>
    </div>

    <div class="mt-3 rounded-2xl border overflow-hidden shadow">
      <iframe
        id="vehForm"
        src="https://docs.google.com/forms/d/e/1FAIpQLScz05vKOikDlfNmvacw73_zjhKntAQQEwoaJnwkT7zGX8mQ0g/viewform?embedded=true"
        class="w-full"
        height="1200"
        frameborder="0"
        marginheight="0"
        marginwidth="0"
      >Cargando…</iframe>
    </div>

    <p class="mt-2 text-xs text-slate-500">* El alto se ajusta a tu ventana; si el formulario es más largo, usa el scroll dentro del recuadro o el botón “Abrir en pestaña nueva”.</p>
  </main>

  <script>
    // Autoajuste de alto del iframe según el viewport (sin acceder al contenido por CORS)
    (function(){
      const iframe = document.getElementById('vehForm');
      const fitBtn = document.getElementById('fitBtn');
      const tallBtn = document.getElementById('tallBtn');

      function fitToViewport(){
        // margen aproximado para header/controles/paddings
        const margin = 240;
        const h = Math.max(window.innerHeight - margin, 600);
        iframe.style.height = h + 'px';
      }

      function setTall(){
        iframe.style.height = '2000px';
      }

      // Inicial y al redimensionar
      window.addEventListener('load', fitToViewport);
      window.addEventListener('resize', () => {
        // simple debounce
        clearTimeout(window.__vehResizeT);
        window.__vehResizeT = setTimeout(fitToViewport, 120);
      });

      fitBtn?.addEventListener('click', fitToViewport);
      tallBtn?.addEventListener('click', setTall);
    })();
  </script>
</body>
</html>
