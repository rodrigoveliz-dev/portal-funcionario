<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Solicitud de Insumos — Portal del Funcionario</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    :root { --verde:#3cb043; --azul:#004aad; --naranjo:#f57c00; }
    .bg-azul{background-color:var(--azul)} .text-azul{color:var(--azul)} .text-verde{color:var(--verde)} .text-naranjo{color:var(--naranjo)}
  </style>
  <script type="module">
    import { createClient } from 'https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2/+esm';
    const supabase = createClient('https://ocqoipzgtsanpyzjcsis.supabase.co', 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im9jcW9pcHpndHNhbnB5empjc2lzIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjExNjEwMDcsImV4cCI6MjA3NjczNzAwN30.mc3mM6ctAyQne5D_Dkw6w9BczzIE9CTe4AQFXqYsMo4');

    async function enforceAuth(){
      const { data: { session } } = await supabase.auth.getSession();
      if(!session){
        window.location.href = 'login.html';
        return;
      }
      document.getElementById('app').classList.remove('hidden');
      const emailBadge = document.getElementById('userEmail');
      if(emailBadge) emailBadge.textContent = session.user.email;
    }

    window.addEventListener('DOMContentLoaded', enforceAuth);
  </script>
</head>
<body class="bg-white text-slate-800">
  <header class="border-b">
    <div class="max-w-5xl mx-auto px-4 h-16 flex items-center justify-between">
      <a href="index.html" class="text-azul font-semibold">← Volver</a>
      <h1 class="text-xl font-bold">Solicitud de Insumos</h1>
      <span id="userEmail" class="text-xs text-slate-500"></span>
    </div>
  </header>

  <!-- App oculta hasta comprobar sesión -->
  <main id="app" class="hidden max-w-5xl mx-auto px-4 py-8">
    <div class="rounded-2xl border overflow-hidden shadow">
      <iframe
        id="insForm"
        src="https://docs.google.com/forms/d/e/1FAIpQLSfHQLXM8d_fpzkHauNqjyyWrRon80LupeVbAbWRbzX2XU2c0A/viewform?embedded=true"
        class="w-full"
        height="1200"
        frameborder="0"
        marginheight="0"
        marginwidth="0"
      >Cargando…</iframe>
    </div>
  </main>

  <script>
    // Autoajuste de alto del iframe según el viewport (sin controles visibles)
    (function(){
      const iframe = document.getElementById('insForm');
      function fitToViewport(){
        const margin = 200; // espacio para header y márgenes
        const h = Math.max(window.innerHeight - margin, 600);
        iframe.style.height = h + 'px';
      }
      window.addEventListener('load', fitToViewport);
      window.addEventListener('resize', () => {
        clearTimeout(window.__insResizeT);
        window.__insResizeT = setTimeout(fitToViewport, 120);
      });
    })();
  </script>
</body>
</html>
